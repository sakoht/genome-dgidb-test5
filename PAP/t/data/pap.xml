<?xml version='1.0' standalone='yes'?>
<workflow name="protein annotation pipeline" executor="Workflow::Executor::SerialDeferred">
  <link fromOperation="input connector"            fromProperty="fasta file"       toOperation="split fasta file"           toProperty="fasta_file" />
  <link fromOperation="input connector"            fromProperty="fasta file"       toOperation="interproscan"               toProperty="fasta_file" />
  <link fromOperation="input connector"            fromProperty="chunk size"       toOperation="split fasta file"           toProperty="chunk_size" />
  <link fromOperation="input connector"            fromProperty="gram stain"       toOperation="annotate protein sequences" toProperty="gram stain" />
  <link fromOperation="input connector"            fromProperty="biosql namespace" toOperation="database upload"            toProperty="biosql_namespace" />
  <link fromOperation="interproscan"               fromProperty="bio_seq_feature"  toOperation="annotate protein sequences" toProperty="interproscan feature" />
  <link fromOperation="split fasta file"           fromProperty="fasta_files"      toOperation="annotate protein sequences" toProperty="fasta file" />
  <link fromOperation="split fasta file"           fromProperty="fasta_files"      toOperation="wait db upload"             toProperty="fasta_files" />
  <link fromOperation="annotate protein sequences" fromProperty="bio seq features" toOperation="database upload"            toProperty="bio_seq_features" />
  <link fromOperation="database upload"            fromProperty="result"           toOperation="wait db upload"             toProperty="db_upload_result" />
  <link fromOperation="wait db upload"             fromProperty="fasta_files"      toOperation="delete files"               toProperty="files" />
  <link fromOperation="wait db upload"             fromProperty="db_upload_result" toOperation="wait delete"                toProperty="db_upload_result" />
  <link fromOperation="delete files"               fromProperty="result"           toOperation="wait delete"                toProperty="delete_result" />
  <link fromOperation="wait delete"                fromProperty="delete_result"    toOperation="output connector"           toProperty="result" />
  <operation name="split fasta file">
    <operationtype commandClass="PAP::Command::FastaChunker" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="interproscan">
    <operationtype commandClass="PAP::Command::InterProScan" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="annotate protein sequences" workflowFile="pap_chunk.xml" />
  <operation name="database upload">
    <operationtype commandClass="PAP::Command::UploadResult" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="wait db upload">
    <operationtype typeClass="Workflow::OperationType::Block">
      <property>fasta_files</property>
      <property>db_upload_result</property>
    </operationtype>
  </operation>
  <operation name="delete files">
    <operationtype commandClass="PAP::Command::DeleteFiles" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="wait delete">
    <operationtype typeClass="Workflow::OperationType::Block">
      <property>delete_result</property>
      <property>db_upload_result</property>
    </operationtype>
  </operation>
  <operationtype typeClass="Workflow::OperationType::Model">
    <inputproperty>fasta file</inputproperty>
    <inputproperty>chunk size</inputproperty>
    <inputproperty>gram stain</inputproperty>
    <inputproperty>biosql namespace</inputproperty>
    <outputproperty>result</outputproperty>
  </operationtype>
</workflow>
