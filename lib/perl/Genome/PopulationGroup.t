#!/usr/bin/env perl
use strict;
use warnings;

use above "Genome";

use Data::Dumper 'Dumper';
use Test::More;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

use_ok('Genome::PopulationGroup') or die;

my $id = -54321;
my $pg = Genome::PopulationGroup->get($id);
ok(!$pg, 'pg does not exist');

my $taxon = Genome::Taxon->get(species_name => 'human');
ok($taxon, 'human taxon');
$pg = Genome::PopulationGroup->create(
    id => $id,
    name => 'Genome Center',
    taxon_id => $taxon->taxon_id,
    description => 'The peeps of the WashU GC',
);
ok($pg, 'created pg');
isa_ok($pg, 'Genome::PopulationGroup');
isa_ok($pg, 'Genome::Measurable');
is($pg->id, $id, "id: $id");
is($pg->subject_type, 'population group', 'subject type is population group');
print Data::Dumper::Dumper($pg);

my $commit = eval{ UR::Context->commit; };
ok($commit, 'commit');

$pg = Genome::PopulationGroup->get($id);
ok($pg, 're-get pg');

done_testing();
exit();

