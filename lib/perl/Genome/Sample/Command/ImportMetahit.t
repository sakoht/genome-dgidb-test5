#!/usr/bin/env perl

use strict;
use warnings;

use above "Genome";
use Test::More;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

UR::DataSource->next_dummy_autogenerated_id;
do {
    $UR::DataSource::last_dummy_autogenerated_id = int($UR::DataSource::last_dummy_autogenerated_id / 10);
} until length($UR::DataSource::last_dummy_autogenerated_id) < 9;
diag('Dummy ID: '.$UR::DataSource::last_dummy_autogenerated_id);
cmp_ok(length($UR::DataSource::last_dummy_autogenerated_id), '<',  9, 'dummy id is shorter than 9 chars');

use_ok('Genome::Sample::Command::ImportMetahit') or die;

my $cmd = Genome::Sample::Command::ImportMetahit->create(
    name => 'MH0000',
    gender => 'male',
    age => 99,
    bmi => 22.4,
);
ok($cmd, 'create');
$cmd->dump_status_messages(1);
ok($cmd->execute, 'execute');

my $commit = eval{ UR::Context->commit; };
ok($commit, 'commit');
                                                  
#my $individual = Genome::Individual->get(name => 'MEGAHIT-MH0000');
#ok($individual, 'got individual');
#my ($sample) = $individual->samples;
#ok($sample, 'got sample');
#is($sample->name, 'MEGAHIT-MH0000-1', 'sample name matches');
#my ($library) = $sample->libraries;
#ok($library, 'got library');
#is($library->name, 'MEGAHIT-MH0000-1-extlibs', 'library name match');

done_testing();
exit();

