<?xml version='1.0' standalone='yes'?>
<workflow name="eukaryotic gene prediction pipeline" executor="Workflow::Executor::SerialDeferred">
    <link fromOperation="input connector"          fromProperty="contig_fasta"                   toOperation="split_fasta"              toProperty="fasta_file" />
    <link fromOperation="input connector"          fromProperty="split_fastas_output_directory"  toOperation="split_fasta"              toProperty="output_directory" />
    <link fromOperation="input connector"          fromProperty="max_bases_per_fasta"            toOperation="split_fasta"              toProperty="max_bases_per_file" />
    <link fromOperation="split_fasta"              fromProperty="fasta_files"                    toOperation="contig_predict_genes"     toProperty="fasta_file" />
    <link fromOperation="input connector"          fromProperty="prediction_directory"           toOperation="contig_predict_genes"     toProperty="prediction_directory" />
    <link fromOperation="input connector"          fromProperty="domain"                         toOperation="contig_predict_genes"     toProperty="domain" />
    <link fromOperation="input connector"          fromProperty="raw_output_directory"           toOperation="contig_predict_genes"     toProperty="raw_output_directory" />
    <link fromOperation="input connector"          fromProperty="repeat_library"                 toOperation="contig_predict_genes"     toProperty="repeat_library" />
    <link fromOperation="input connector"          fromProperty="xsmall"                         toOperation="contig_predict_genes"     toProperty="xsmall" />
    <link fromOperation="input connector"          fromProperty="snap_models"                    toOperation="contig_predict_genes"     toProperty="snap_models" />
    <link fromOperation="input connector"          fromProperty="fgenesh_model"                  toOperation="contig_predict_genes"     toProperty="fgenesh_model" />
    <link fromOperation="input connector"          fromProperty="rnammer_version"                toOperation="contig_predict_genes"     toProperty="rnammer_version" />
    <link fromOperation="input connector"          fromProperty="rfamscan_version"               toOperation="contig_predict_genes"     toProperty="rfamscan_version" />
    <link fromOperation="input connector"          fromProperty="snap_version"                   toOperation="contig_predict_genes"     toProperty="snap_version" />
    <link fromOperation="input connector"          fromProperty="skip_masking_if_no_rna"         toOperation="contig_predict_genes"     toProperty="skip_masking_if_no_rna" />
    <link fromOperation="input connector"          fromProperty="skip_repeat_masker"             toOperation="contig_predict_genes"     toProperty="skip_repeat_masker" />
    <link fromOperation="contig_predict_genes"     fromProperty="temp_prediction_directory"      toOperation="merge_predictions"        toProperty="temp_prediction_directories" />
    <link fromOperation="input connector"          fromProperty="prediction_directory"           toOperation="merge_predictions"        toProperty="prediction_directory" />
    <link fromOperation="merge_predictions"        fromProperty="prediction_directory"           toOperation="cleanup_temp_files"       toProperty="directory" />
    <link fromOperation="cleanup_temp_files"       fromProperty="result"                         toOperation="output connector"         toProperty="result" />
  
    <operation name="split_fasta">
        <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::SplitFasta" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="merge_predictions">
        <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::MergePredictions" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="cleanup_temp_files">
        <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::CleanupTempFiles" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="contig_predict_genes" parallelBy="fasta_file">
        <link fromOperation="input connector"          fromProperty="fasta_file"                  toOperation="repeat_masker"            toProperty="fasta_file" />
        <link fromOperation="input connector"          fromProperty="xsmall"                      toOperation="repeat_masker"            toProperty="xsmall" />
        <link fromOperation="input connector"          fromProperty="repeat_library"              toOperation="repeat_masker"            toProperty="repeat_library" />
        <link fromOperation="input connector"          fromProperty="skip_repeat_masker"          toOperation="repeat_masker"            toProperty="skip_masking" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="repeat_masker"            toProperty="temp_working_directory" />
        <link fromOperation="repeat_masker"            fromProperty="masked_fasta"                toOperation="rnammer"                  toProperty="fasta_file" />
        <link fromOperation="repeat_masker"            fromProperty="masked_fasta"                toOperation="trnascan"                 toProperty="fasta_file" />
        <link fromOperation="repeat_masker"            fromProperty="masked_fasta"                toOperation="rfamscan"                 toProperty="fasta_file" />
        <link fromOperation="input connector"          fromProperty="rnammer_version"             toOperation="rnammer"                  toProperty="version" />
        <link fromOperation="input connector"          fromProperty="rfamscan_version"            toOperation="rfamscan"                 toProperty="version" />
        <link fromOperation="input connector"          fromProperty="snap_version"                toOperation="snap"                     toProperty="version" />
        <link fromOperation="input connector"          fromProperty="fasta_file"                  toOperation="make_temp_prediction_dir" toProperty="fasta_file" />
        <link fromOperation="input connector"          fromProperty="prediction_directory"        toOperation="make_temp_prediction_dir" toProperty="base_prediction_directory" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="rfamscan"                 toProperty="raw_output_directory" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="rnammer"                  toProperty="raw_output_directory" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="trnascan"                 toProperty="raw_output_directory" />
        <link fromOperation="make_temp_prediction_dir" fromProperty="temp_prediction_directory"   toOperation="rfamscan"                 toProperty="prediction_directory" />
        <link fromOperation="make_temp_prediction_dir" fromProperty="temp_prediction_directory"   toOperation="rnammer"                  toProperty="prediction_directory" />
        <link fromOperation="make_temp_prediction_dir" fromProperty="temp_prediction_directory"   toOperation="trnascan"                 toProperty="prediction_directory" />
        <link fromOperation="input connector"          fromProperty="domain"                      toOperation="rnammer"                  toProperty="domain" />
        <link fromOperation="input connector"          fromProperty="domain"                      toOperation="trnascan"                 toProperty="domain" />
        <link fromOperation="rfamscan"                 fromProperty="prediction_directory"        toOperation="wait_rna_prediction"      toProperty="rfamscan_prediction_dir" />
        <link fromOperation="rnammer"                  fromProperty="prediction_directory"        toOperation="wait_rna_prediction"      toProperty="rnammer_prediction_dir" />
        <link fromOperation="trnascan"                 fromProperty="prediction_directory"        toOperation="wait_rna_prediction"      toProperty="trnascan_prediction_dir" />
        <link fromOperation="input connector"          fromProperty="skip_masking_if_no_rna"      toOperation="mask_rna_sequence"        toProperty="skip_if_no_rna_file" />
        <link fromOperation="repeat_masker"            fromProperty="masked_fasta"                toOperation="mask_rna_sequence"        toProperty="fasta_file" />
        <link fromOperation="wait_rna_prediction"      fromProperty="rfamscan_prediction_dir"     toOperation="mask_rna_sequence"        toProperty="prediction_directory" />
        <link fromOperation="input connector"          fromProperty="snap_models"                 toOperation="snap"                     toProperty="model_files" />
        <link fromOperation="mask_rna_sequence"        fromProperty="masked_fasta_file"           toOperation="snap"                     toProperty="fasta_file" />
        <link fromOperation="make_temp_prediction_dir" fromProperty="temp_prediction_directory"   toOperation="snap"                     toProperty="prediction_directory" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="snap"                     toProperty="raw_output_directory" />
        <link fromOperation="input connector"          fromProperty="fgenesh_model"               toOperation="fgenesh"                  toProperty="model_file" />
        <link fromOperation="mask_rna_sequence"        fromProperty="masked_fasta_file"           toOperation="fgenesh"                  toProperty="fasta_file" />
        <link fromOperation="make_temp_prediction_dir" fromProperty="temp_prediction_directory"   toOperation="fgenesh"                  toProperty="prediction_directory" />
        <link fromOperation="input connector"          fromProperty="raw_output_directory"        toOperation="fgenesh"                  toProperty="raw_output_directory" />
        <link fromOperation="snap"                     fromProperty="prediction_directory"        toOperation="wait_gene_prediction"     toProperty="snap_prediction_dir" />
        <link fromOperation="fgenesh"                  fromProperty="prediction_directory"        toOperation="wait_gene_prediction"     toProperty="fgenesh_prediction_dir" />
        <link fromOperation="wait_gene_prediction"     fromProperty="snap_prediction_dir"         toOperation="output connector"         toProperty="temp_prediction_directory" />
        <link fromOperation="mask_rna_sequence"        fromProperty="masked_fasta_file"           toOperation="output connector"         toProperty="masked_fasta_file" />

        <operation name="make_temp_prediction_dir">
            <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::MakeTempPredictionDirectory" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="repeat_masker">
            <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::RepeatMasker" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="rfamscan">
            <operationtype commandClass="Genome::Model::Tools::GenePredictor::RfamScan" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="rnammer">
            <operationtype commandClass="Genome::Model::Tools::GenePredictor::RNAmmer" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="trnascan">
            <operationtype commandClass="Genome::Model::Tools::GenePredictor::tRNAscan" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="wait_rna_prediction">
            <operationtype typeClass="Workflow::OperationType::Block">
                <property>rfamscan_prediction_dir</property>
                <property>rnammer_prediction_dir</property>
                <property>trnascan_prediction_dir</property>
            </operationtype>
        </operation>
        <operation name="mask_rna_sequence">
            <operationtype commandClass="Genome::Model::GenePrediction::Eukaryotic::MaskRnaSequence" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="snap">
            <operationtype commandClass="Genome::Model::Tools::GenePredictor::SNAP" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="fgenesh">
            <operationtype commandClass="Genome::Model::Tools::GenePredictor::Fgenesh" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="wait_gene_prediction">
            <operationtype typeClass="Workflow::OperationType::Block">
                <property>snap_prediction_dir</property>
                <property>fgenesh_prediction_dir</property>
            </operationtype>
        </operation>

        <operationtype typeClass="Workflow::OperationType::Model">
            <inputproperty>skip_repeat_masker</inputproperty>
            <inputproperty>rnammer_version</inputproperty>
            <inputproperty>rfamscan_version</inputproperty>
            <inputproperty>snap_version</inputproperty>
            <inputproperty>skip_masking_if_no_rna</inputproperty>
            <inputproperty>repeat_library</inputproperty>
            <inputproperty>xsmall</inputproperty>
            <inputproperty>domain</inputproperty>
            <inputproperty>raw_output_directory</inputproperty>
            <inputproperty>fasta_file</inputproperty>
            <inputproperty>prediction_directory</inputproperty>
            <inputproperty>snap_models</inputproperty>
            <inputproperty>fgenesh_model</inputproperty>
            <outputproperty>temp_prediction_directory</outputproperty>
            <outputproperty>masked_fasta_file</outputproperty>
        </operationtype>
    </operation>

    <operationtype typeClass="Workflow::OperationType::Model">
        <inputproperty>skip_repeat_masker</inputproperty>
        <inputproperty>rnammer_version</inputproperty>
        <inputproperty>rfamscan_version</inputproperty>
        <inputproperty>snap_version</inputproperty>
        <inputproperty>skip_masking_if_no_rna</inputproperty>
        <inputproperty>repeat_library</inputproperty>
        <inputproperty>xsmall</inputproperty>
        <inputproperty>domain</inputproperty>
        <inputproperty>contig_fasta</inputproperty>
        <inputproperty>max_bases_per_fasta</inputproperty>
        <inputproperty>split_fastas_output_directory</inputproperty>
        <inputproperty>raw_output_directory</inputproperty>
        <inputproperty>prediction_directory</inputproperty>
        <inputproperty>snap_models</inputproperty>
        <inputproperty>fgenesh_model</inputproperty>
        <outputproperty>result</outputproperty>
    </operationtype>
</workflow>
