#!/usr/bin/perl -w
#Written by Malachi Griffith

#Purpose:
#This script queries the clinicalTrials.gov website using a list of gene names
#Each query will be submitted by URL crafting
#The result will be an autogenerated XML file listing the clinical trials that match the search term
#Each match in the result will contain the clinical trial ID and a score for the match
#This script will parse the critical information out and store Gene-to-ClinicalTrial interactions along with their score for future use

use strict;
use warnings;
use Term::ANSIColor qw(:constants);
use Getopt::Long;
use Data::Dumper;
use XML::Simple;
binmode(STDOUT, ":utf8");
use Cwd 'abs_path';
my $script_dir;
BEGIN{
  if (abs_path($0) =~ /(.*\/).*\/.*\.pl/){
    $script_dir = $1;
  }
}
use lib $script_dir;
use ClinSeq qw(:all);
use lib $script_dir."/drug-genes";
use utility qw(:all);

my $annotation_dir = '';
my $outdir = '';
my $debug = '';
my $record_limit = '';
my $verbose = '';

GetOptions ('annotation_dir=s'=>\$annotation_dir, 'outdir=s'=>\$outdir , 'debug=s'=>\$debug, 'record_limit=i'=>\$record_limit, 'verbose=i'=>\$verbose);

my $usage=<<INFO;

  Example usage: 
  
  parseClinicalTrialsGovXml.pl  --annotation_dir=/gscmnt/sata132/techd/mgriffit/reference_annotations/  --outdir=/gscmnt/sata132/techd/mgriffit/DruggableGenes/KnownDruggable/ClinicalTrialsGov/interactions/

  Details:
  --annotation_dir            PATH.  Directory containing gene info for gene name mapping ('gene2accession' and 'gene_info')
  --outdir                    PATH.  Directory to store interaction flatfiles generated by parsing the XML files
  --debug                     INT.   Testing purposes
  --record_limit              INT.   Only process this many records 
  --verbose                   INT.   More output
INFO

unless ($annotation_dir && $outdir){
  print GREEN, "\n\n$usage\n\n", RESET;
  exit();
}
unless($record_limit){
  $record_limit = 1;
}

$annotation_dir = &checkDir('-dir'=>$annotation_dir, '-clear'=>"no");
$outdir = &checkDir('-dir'=>$outdir, '-clear'=>"no");

#Get annotation gene names and synonyms
print BLUE, "\n\nLoading gene annotation data from: $annotation_dir", RESET;
my $annotation_data = &loadEntrezEnsemblData();

my $entrez_symbols = $annotation_data->{'symbols'};
my $entrez_synonyms = $annotation_data->{'synonyms'};

#Instantiate an XML simple object
my $xs1 = XML::Simple->new();



print "\n\n";

exit();


