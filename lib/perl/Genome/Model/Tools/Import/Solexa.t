#!/gsc/bin/perl
use strict;
use warnings;

use Test::More tests => 8;

App::DB::TableRow->use_dummy_autogenerated_ids(1);
App::DBI->no_commit(1);

use above 'Genome';
$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

BEGIN {
    use_ok('Genome::Model::Tools::Import::Solexa');
};

my $data_file_path = '/gsc/var/cache/testsuite/data/Genome-Model-Tools-Import-Solexa/test.fastq';

my $importer;
eval {
    $importer = Genome::Model::Tools::Import::Solexa->create();
};
ok($@,'Failed to create importer without required params');

$importer = Genome::Model::Tools::Import::Solexa->create(
                                                         read_length => -1,
                                                         external_data_source => 'test_external_data_source',
                                                         research_project => 'test_research_project',
                                                         sample_name => 'test_sample_name',
                                                         data_file => 'test_data_file',
                                                     );
isa_ok($importer,'Genome::Model::Tools::Import::Solexa');
$importer->queue_error_messages(1);
ok(!$importer->execute,'Failed to execute importer');
ok(scalar( grep { 'test_data_file does not exist' } $importer->error_messages),'Found error about missing data file');

$importer = Genome::Model::Tools::Import::Solexa->create(
                                                         read_length => -1,
                                                         external_data_source => 'test_external_data_source',
                                                         research_project => 'test_research_project',
                                                         sample_name => 'test_sample_name',
                                                         data_file => $data_file_path,
                                                     );
ok($importer->execute,'execute command '. $importer->command_name);
my $sls = $importer->_run_lane_solexa;
isa_ok($sls,'GSC::RunLaneSolexa');
is($sls->lane,1,'default lane of 1');



exit;
