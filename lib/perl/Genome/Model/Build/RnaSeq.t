#!/usr/bin/env perl


use strict;
use warnings;

use above 'Genome';
use Test::More;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;


my $pp = Genome::ProcessingProfile::RnaSeq->__define__(
    annotation_reference_transcripts_mode => 'reference only',
    name => 'test annotation build validation - rnaseq',
);

my $annotation_build = Genome::Model::Build::ImportedAnnotation->__define__(
    name => 'test annotation'
);

my $rna_model_with_annotation = Genome::Model::RnaSeq->__define__(
    annotation_build => $annotation_build,
    processing_profile => $pp,
    name => 'test rnaseq with annotation'
);

my $rna_model_without_annotation = Genome::Model::RnaSeq->__define__(
    processing_profile => $pp,
    name => 'test rnaseq without annotation'
);

my $build_with_annotation = Genome::Model::Build::RnaSeq->create(
    model => $rna_model_with_annotation
);

my $build_without_annotation = Genome::Model::Build::RnaSeq->create(
    model => $rna_model_without_annotation
);

my @tags = $build_with_annotation->validate_for_start;

is((grep {$_->type eq 'invalid' && ($_->properties)[0] eq 'annotation_build' } @tags), 0, 'build with annotation does not fail start checks');

@tags = $build_without_annotation->validate_for_start;

is((grep {$_->type eq 'invalid' && ($_->properties)[0] eq 'annotation_build' } @tags), 1, 'build without annotation does fails start checks');

done_testing();
