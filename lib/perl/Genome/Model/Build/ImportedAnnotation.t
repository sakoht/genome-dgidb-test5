#!/usr/bin/env perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}
use above "Genome";
use Test::More tests => 9;
use_ok('Genome::Model::Build::ImportedAnnotation');

my $human_rsb36 = Genome::Model::Build::ImportedReferenceSequence->get(name => "NCBI-human-build36");
my $human_rsb37 = Genome::Model::Build::ImportedReferenceSequence->get(name => "NCBI-human-build37");
my $mouse_rsb37 = Genome::Model::Build::ImportedReferenceSequence->get(name => "NCBI-mouse-build37");
my $human_ann_model = Genome::Model::ImportedAnnotation->get(name => "NCBI-human.combined-annotation");
my $mouse_ann_model = Genome::Model::ImportedAnnotation->get(name => "NCBI-mouse.combined-annotation");
my $ann_human36 = $human_ann_model->build_by_version("54_36p_v2");
my $ann_mouse37 = $mouse_ann_model->build_by_version("54_37g_v2");

ok($ann_human36->idstring eq "NCBI-human.combined-annotation/54_36p_v2", "idstring properly formed");
ok($ann_mouse37->idstring eq "NCBI-mouse.combined-annotation/54_37g_v2", "idstring properly formed");

ok($ann_human36->is_compatible_with_reference_sequence_build($human_rsb36), "human build 36 annotation and ref seq");
ok(!$ann_human36->is_compatible_with_reference_sequence_build($human_rsb37), "human build 36 annotation with build 37 ref seq");
ok(!$ann_human36->is_compatible_with_reference_sequence_build($mouse_rsb37), "human build 36 annotation with mouse build 37 ref seq");

ok($ann_mouse37->is_compatible_with_reference_sequence_build($mouse_rsb37), "mouse build 37 annotation and ref seq");
ok(!$ann_mouse37->is_compatible_with_reference_sequence_build($human_rsb36), "mouse build 37 annotation with human build 36 ref seq");
ok(!$ann_mouse37->is_compatible_with_reference_sequence_build($human_rsb37), "mouse build 37 annotation with build 37 ref seq");

done_testing();
