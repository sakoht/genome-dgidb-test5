<?xml version='1.0' standalone='yes'?>
<workflow name="gene prediction pipeline" executor="Workflow::Executor::SerialDeferred" logDir="/gscuser/bdericks/egap_testing">
  <link fromOperation="input connector"          fromProperty="output directory"   toOperation="create directories"       toProperty="output_directory" />
  <link fromOperation="input connector"          fromProperty="seq set id"         toOperation="get sequence fasta files" toProperty="seq_set_id" />
  <link fromOperation="input connector"          fromProperty="seq set id"         toOperation="wait delete"              toProperty="seq_set_id" />
  <link fromOperation="input connector"          fromProperty="seq set id"         toOperation="database upload"          toProperty="seq_set_id" />
  <link fromOperation="input connector"          fromProperty="domain"             toOperation="contig predict genes"     toProperty="domain" />
  <link fromOperation="input connector"          fromProperty="fgenesh model"      toOperation="contig predict genes"     toProperty="fgenesh model" />
  <link fromOperation="input connector"          fromProperty="snap model"         toOperation="contig predict genes"     toProperty="snap model" />
  <link fromOperation="input connector"          fromProperty="snap version"       toOperation="contig predict genes"     toProperty="snap version" />

  <link fromOperation="create directories"       fromProperty="split_fastas_output_directory"  toOperation="get sequence fasta files" toProperty="output_directory"/>
  <link fromOperation="create directories"       fromProperty="fgenesh_output_directory"       toOperation="contig predict genes"     toProperty="fgenesh_output_directory" />
  <link fromOperation="create directories"       fromProperty="snap_output_directory"          toOperation="contig predict genes"     toProperty="snap_output_directory" />
  <link fromOperation="create directories"       fromProperty="rnammer_output_directory"       toOperation="contig predict genes"     toProperty="rnammer_output_directory" />
  <link fromOperation="create directories"       fromProperty="rfamscan_output_directory"      toOperation="contig predict genes"     toProperty="rfamscan_output_directory" />
  <link fromOperation="create directories"       fromProperty="trnascan_output_directory"      toOperation="contig predict genes"     toProperty="trnascan_output_directory" />
  <link fromOperation="create directories"       fromProperty="masked_fastas_output_directory" toOperation="contig predict genes"     toProperty="masked_fastas_output_directory" />

  <link fromOperation="get sequence fasta files" fromProperty="fasta_files"        toOperation="contig predict genes"     toProperty="fasta file" />
  <link fromOperation="contig predict genes"     fromProperty="bio seq features"   toOperation="database upload"          toProperty="bio_seq_features" />
  <link fromOperation="database upload"          fromProperty="result"             toOperation="wait db upload"           toProperty="db upload result" />
  <link fromOperation="get sequence fasta files" fromProperty="fasta_files"        toOperation="wait db upload"           toProperty="fasta_files" />
  <link fromOperation="wait db upload"           fromProperty="fasta_files"        toOperation="delete files"             toProperty="files" />
  <link fromOperation="wait db upload"           fromProperty="db upload result"   toOperation="wait delete"              toProperty="db upload result" />
  <link fromOperation="delete files"             fromProperty="result"             toOperation="wait delete"              toProperty="delete result" />
  <link fromOperation="wait delete"              fromProperty="delete result"      toOperation="output connector"         toProperty="result" />
  <operation name="create directories">
    <operationtype commandClass="EGAP::Command::CreateDirectories" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="get sequence fasta files">
    <operationtype commandClass="EGAP::Command::GetFastaFiles" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="contig predict genes" workflowFile="egap_contig_new.xml" />
  <operation name="database upload">
    <operationtype commandClass="EGAP::Command::UploadResult" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="wait db upload">
    <operationtype typeClass="Workflow::OperationType::Block">
      <property>fasta_files</property>
      <property>db upload result</property>
    </operationtype>
  </operation>
  <operation name="delete files">
    <operationtype commandClass="EGAP::Command::DeleteFiles" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="wait delete">
    <operationtype typeClass="Workflow::OperationType::Block">
      <property>delete result</property>
      <property>db upload result</property>
      <property>seq_set_id</property>
    </operationtype>
  </operation>
  <operationtype typeClass="Workflow::OperationType::Model">
    <inputproperty>output directory</inputproperty>
    <inputproperty>seq set id</inputproperty>
    <inputproperty>snap model</inputproperty>
    <inputproperty>snap version</inputproperty>
    <inputproperty>fgenesh model</inputproperty>
    <inputproperty>domain</inputproperty>
    <outputproperty>result</outputproperty>
  </operationtype>
</workflow>
