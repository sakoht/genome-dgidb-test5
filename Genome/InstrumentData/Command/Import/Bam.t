#!/usr/bin/env perl
use strict;
use warnings;

$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = "1";
$ENV{UR_DBI_NO_COMMIT} = "1";

use above "Genome";
use Test::More tests => 6;

my $s = Genome::Sample->get(2824113569);

my $i = Genome::InstrumentData::Command::Import::Bam->create(
    sample_name         => $s->name,  
    import_source_name  => 'Broad',
    original_data_path  => '/gsc/var/cache/testsuite/data/Genome-InstrumentData--Command-Import-Bam/test.bam',
    import_format       => 'bam',
    sequencing_platform => 'solexa',
    description         => 'bwa file',
    species_name        => 'human',
);

ok($i, "Import Bam Command created ok");
ok($i->execute,"Test Bam is imported ok");

note "instrument data id is ". $i->import_instrument_data_id."\n";

my $i_d = Genome::InstrumentData->get($i->import_instrument_data_id);
is($i_d->sequencing_platform,'solexa','platform is correct');
is($i_d->user_name, $ENV{USER}, "user name is correct");
ok($i_d->import_date, "date is set");

my $ok;
eval { $ok = UR::Context->_sync_databases(); };
ok($ok, "saves to the database!");

#UR::Context->commit;
#call $instrument_data->delete to delete

