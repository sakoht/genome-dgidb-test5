#!/gsc/bin/perl

use strict;
use warnings;

use Test::More tests => 13;
use above 'Genome';

my $base_class = 'Genome::InstrumentData';

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    use_ok('Genome::InstrumentData');
};

my %seq_plats_and_ids = (
    454     => '2403581188',
    sanger  => '03may05.868pmaa1',
    solexa  => '2338813239',
);

my @rcs = Genome::InstrumentData->get([ values %seq_plats_and_ids ]);
is(scalar(@rcs), 3, "got 3 objects");

for my $platform (keys %seq_plats_and_ids) {
    note("Now test $platform");
    
    my $subclass = $base_class.'::'.ucfirst($platform);
    use_ok($subclass);
    
    my $instrument_data =Genome::InstrumentData->get($seq_plats_and_ids{$platform});
    isa_ok($instrument_data, $subclass);
    is($instrument_data->sequencing_platform, $platform, 'platform is correct');
    
    if ( $platform eq 'solexa' ) {
        is($instrument_data->sample_type,'rna','got expected sample type');
        is($instrument_data->resolve_quality_converter,'sol2sanger','got expected quality converter');
    }
}

#$HeadURL$
#$Id$
