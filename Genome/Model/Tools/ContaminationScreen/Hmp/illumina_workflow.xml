<?xml version='1.0' standalone='yes'?>
<workflow name="human contamination screening" executor="Workflow::Executor::SerialDeferred" logDir="/gscmnt/sata409/research/mmitreva/edemello/workflow_logs">
    <link fromOperation="input connector"       fromProperty="fastq_1"                  toOperation="remove n 1"                toProperty="fastq_file" />
    <link fromOperation="input connector"       fromProperty="fastq_1"                  toOperation="synch fastq"               toProperty="fastq1" />
    <link fromOperation="input connector"       fromProperty="n_removed_file_1"         toOperation="remove n 1"                toProperty="n_removed_file" />
    <link fromOperation="input connector"       fromProperty="n_removed_file_1"         toOperation="wait for n removal 1"      toProperty="files_to_align_path_1" />
    <link fromOperation="input connector"       fromProperty="fastq_2"                  toOperation="remove n 2"                toProperty="fastq_file" />
    <link fromOperation="input connector"       fromProperty="fastq_2"                  toOperation="synch fastq"               toProperty="fastq2" />
    <link fromOperation="input connector"       fromProperty="n_removed_file_2"         toOperation="remove n 2"                toProperty="n_removed_file" />
    <link fromOperation="input connector"       fromProperty="n_removed_file_2"         toOperation="wait for n removal 2"      toProperty="files_to_align_path_2" />

    <link fromOperation="input connector"       fromProperty="prefix1"                  toOperation="synch fastq"               toProperty="prefix1" />
    <link fromOperation="input connector"       fromProperty="prefix2"                  toOperation="synch fastq"               toProperty="prefix2" />

    <link fromOperation="input connector"       fromProperty="output"                   toOperation="synch fastq"               toProperty="output" />

    <link fromOperation="input connector"       fromProperty="align_options_1"          toOperation="run screen 1"              toProperty="align_options" />
    <link fromOperation="input connector"       fromProperty="aligner_output_file_1"    toOperation="run screen 1"              toProperty="aligner_output_file" />
    <link fromOperation="input connector"       fromProperty="alignment_file_1"         toOperation="run screen 1"              toProperty="alignment_file" /> 
    <link fromOperation="input connector"       fromProperty="ref_seq_file"             toOperation="run screen 1"              toProperty="ref_seq_file" />
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_1"   toOperation="run screen 1"              toProperty="unaligned_reads_file" /> 
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_1"   toOperation="wait for screen"           toProperty="sam1" /> 
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_1"   toOperation="resurrect duplicates"      toProperty="orig_sam1" /> 

    <link fromOperation="input connector"       fromProperty="align_options_2"          toOperation="run screen 2"              toProperty="align_options" />
    <link fromOperation="input connector"       fromProperty="aligner_output_file_2"    toOperation="run screen 2"              toProperty="aligner_output_file" />
    <link fromOperation="input connector"       fromProperty="alignment_file_2"         toOperation="run screen 2"              toProperty="alignment_file" /> 
    <link fromOperation="input connector"       fromProperty="ref_seq_file"             toOperation="run screen 2"              toProperty="ref_seq_file" />
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_2"   toOperation="run screen 2"              toProperty="unaligned_reads_file" /> 
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_2"   toOperation="wait for screen"           toProperty="sam2" /> 
    <link fromOperation="input connector"       fromProperty="unaligned_reads_file_2"   toOperation="resurrect duplicates"      toProperty="orig_sam2" /> 

    <link fromOperation="input connector"       fromProperty="paired_end_file_1"        toOperation="wait for screen"           toProperty="paired_end_file_1" />
    <link fromOperation="input connector"       fromProperty="paired_end_file_2"        toOperation="wait for screen"           toProperty="paired_end_file_2" />
    <link fromOperation="input connector"       fromProperty="deduplicated_file_1"      toOperation="dedup 1"                   toProperty="deduplicated_file" />
    <link fromOperation="input connector"       fromProperty="deduplicated_file_2"      toOperation="dedup 2"                   toProperty="deduplicated_file" />

    <link fromOperation="input connector"       fromProperty="resurrected_file_1"       toOperation="resurrect duplicates"      toProperty="output_file1" />
    <link fromOperation="input connector"       fromProperty="resurrected_file_2"       toOperation="resurrect duplicates"      toProperty="output_file2" />
    <link fromOperation="input connector"       fromProperty="resurrected_file_1"       toOperation="wait for resurrect"        toProperty="sam1" />
    <link fromOperation="input connector"       fromProperty="resurrected_file_2"       toOperation="wait for resurrect"        toProperty="sam2" />

    <link fromOperation="remove n 1"            fromProperty="result"                   toOperation="wait for n removal 1"      toProperty="n_removal_1_complete" />
    <link fromOperation="remove n 2"            fromProperty="result"                   toOperation="wait for n removal 2"      toProperty="n_removal_2_complete" />
    <link fromOperation="wait for n removal 1"  fromProperty="files_to_align_path_1"    toOperation="run screen 1"              toProperty="files_to_align_path" />
    <link fromOperation="wait for n removal 2"  fromProperty="files_to_align_path_2"    toOperation="run screen 2"              toProperty="files_to_align_path" />
    <link fromOperation="run screen 1"          fromProperty="result"                   toOperation="wait for screen"           toProperty="bwa_1_complete" />
    <link fromOperation="run screen 2"          fromProperty="result"                   toOperation="wait for screen"           toProperty="bwa_2_complete" />
    <link fromOperation="wait for screen"       fromProperty="sam1"                     toOperation="remove paired ends"        toProperty="sam1" />
    <link fromOperation="wait for screen"       fromProperty="sam2"                     toOperation="remove paired ends"        toProperty="sam2" />
    <link fromOperation="wait for screen"       fromProperty="paired_end_file_1"        toOperation="remove paired ends"        toProperty="paired_end_removed_file1" />
    <link fromOperation="wait for screen"       fromProperty="paired_end_file_2"        toOperation="remove paired ends"        toProperty="paired_end_removed_file2" />
    <link fromOperation="wait for screen"       fromProperty="paired_end_file_1"        toOperation="wait for per"              toProperty="paired_end_removed_file1" />
    <link fromOperation="wait for screen"       fromProperty="paired_end_file_2"        toOperation="wait for per"              toProperty="paired_end_removed_file2" />
    <link fromOperation="remove paired ends"    fromProperty="result"                   toOperation="wait for per"              toProperty="per_complete" />

    <link fromOperation="wait for per"          fromProperty="paired_end_removed_file1" toOperation="dedup 1"                   toProperty="sam_file" />
    <link fromOperation="wait for per"          fromProperty="paired_end_removed_file2" toOperation="dedup 2"                   toProperty="sam_file" />

    <link fromOperation="dedup 1"               fromProperty="result"                   toOperation="wait for dedup 1"          toProperty="dedup_1_complete" />
    <link fromOperation="dedup 1"               fromProperty="deduplicated_file"        toOperation="wait for dedup 1"          toProperty="deduplicated_file1" />
    <link fromOperation="dedup 2"               fromProperty="result"                   toOperation="wait for dedup 2"          toProperty="dedup_2_complete" />
    <link fromOperation="dedup 2"               fromProperty="deduplicated_file"        toOperation="wait for dedup 2"          toProperty="deduplicated_file2" />

    <link fromOperation="wait for dedup 1"      fromProperty="deduplicated_file1"       toOperation="resurrect duplicates"      toProperty="raw_dedup_sam1" />
    <link fromOperation="wait for dedup 2"      fromProperty="deduplicated_file2"       toOperation="resurrect duplicates"      toProperty="raw_dedup_sam2" />

    <link fromOperation="resurrect duplicates"  fromProperty="result"                   toOperation="wait for resurrect"        toProperty="resurrect_complete" />

    <link fromOperation="wait for resurrect"    fromProperty="sam1"                     toOperation="synch fastq"               toProperty="name1" />
    <link fromOperation="wait for resurrect"    fromProperty="sam2"                     toOperation="synch fastq"               toProperty="name2" />

    <link fromOperation="synch fastq"           fromProperty="result"                   toOperation="output connector"          toProperty="result" />

    <operation name="remove n 1">
        <operationtype commandClass="Genome::Model::Tools::Fastq::RemoveN" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="remove n 2">
        <operationtype commandClass="Genome::Model::Tools::Fastq::RemoveN" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="wait for n removal 1">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>files_to_align_path_1</property>
            <property>n_removal_1_complete</property>
        </operationtype>
    </operation>

    <operation name="wait for n removal 2">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>files_to_align_path_2</property>
            <property>n_removal_2_complete</property>
        </operationtype>
    </operation>

    <operation name="run screen 1" workflowFile="bwa_screen.xml"/>

    <operation name="run screen 2" workflowFile="bwa_screen.xml"/>

    <operation name="wait for screen">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>bwa_1_complete</property>
            <property>bwa_2_complete</property>
            <property>sam1</property>
            <property>sam2</property>
            <property>paired_end_file_1</property>
            <property>paired_end_file_2</property>
        </operationtype>
    </operation>

    <operation name="remove paired ends">
        <operationtype commandClass="Genome::Model::Tools::Sam::RemovePairedEnds" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="wait for per">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>paired_end_removed_file1</property> 
            <property>paired_end_removed_file2</property> 
            <property>per_complete</property>
        </operationtype>
    </operation>

    <operation name="dedup 1">
        <operationtype commandClass="Genome::Model::Tools::Sam::Deduplicator" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="dedup 2">
        <operationtype commandClass="Genome::Model::Tools::Sam::Deduplicator" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="wait for dedup 1">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>dedup_1_complete</property>
            <property>deduplicated_file1</property>
        </operationtype>
    </operation>

    <operation name="wait for dedup 2">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>dedup_2_complete</property>
            <property>deduplicated_file2</property>
        </operationtype>
    </operation>

    <operation name="resurrect duplicates">
        <operationtype commandClass="Genome::Model::Tools::Sam::ResurrectDuplicates" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="wait for resurrect">
        <operationtype typeClass="Workflow::OperationType::Block">
            <property>resurrect_complete</property>
            <property>sam1</property>
            <property>sam2</property>
        </operationtype>
    </operation>

    <operation name="synch fastq">
        <operationtype commandClass="Genome::Model::Tools::Synch" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operationtype typeClass="Workflow::OperationType::Model">
        <inputproperty>align_options_1</inputproperty>
        <inputproperty>aligner_output_file_1</inputproperty>
        <inputproperty>alignment_file_1</inputproperty>
        <inputproperty>ref_seq_file</inputproperty>
        <inputproperty>unaligned_reads_file_1</inputproperty>
        <inputproperty>n_removed_file_1</inputproperty>
        <inputproperty>fastq_1</inputproperty>
        <inputproperty>align_options_2</inputproperty>
        <inputproperty>aligner_output_file_2</inputproperty>
        <inputproperty>alignment_file_2</inputproperty>
        <inputproperty>unaligned_reads_file_2</inputproperty>
        <inputproperty>n_removed_file_2</inputproperty>
        <inputproperty>fastq_2</inputproperty>
        <inputproperty>paired_end_file_1</inputproperty>
        <inputproperty>paired_end_file_2</inputproperty>
        <inputproperty>deduplicated_file_1</inputproperty>
        <inputproperty>deduplicated_file_2</inputproperty>
        <inputproperty>resurrected_file_1</inputproperty>
        <inputproperty>resurrected_file_2</inputproperty>
        <inputproperty>output</inputproperty>
        <inputproperty>prefix1</inputproperty>
        <inputproperty>prefix2</inputproperty>
        <outputproperty>result</outputproperty>
    </operationtype>
</workflow>

